extends layout

block content
  .container.h4
    if (!user) || (user == null)          
      a.btn.btn-primary(href="/auth/twitter") Login with Twitter
    if (user)
      p.small.text-right.bg-success(style="padding: 10px") You are currently logged in as: #{user['screen_name']}
      span
      a.btn.btn-primary(href="/logout" style="margin: 5px") Logout
    p
    .well   
      form(role='form', action='/search', enctype="application/json", method='post')
        span.h4 Search Yelp API: 
        .form-group.h4
          br          
          input(type='text', name="search", value="Look for:")
          | &nbsp;in&nbsp;
          input(type='text', name="zipcode", value="Zip code")
          | ?
        br          
        button.btn(name='submit', type='submit') Search!     
    
    if (results)    
      table.table
        tr
          th.text-center  Search Results:     
        each val, index in results
          tr
          - userDataIndex = userdata.indexOf( val.id )
            td #{val.name}&nbsp;
              span
              if (userdata)                
                if userDataIndex < 0
                  button.btn-xs.btn-warning(name='rsvp')
                    a(href='/rsvp/#{val.id}') RSVP
                else
                  button.btn-xs.btn-danger(name='unrsvp')
                    a(href='/unrsvp/#{val.id}') UnRSVP  
            td              
              if (rsvps_count[userDataIndex] > 0)
                span RSVPs: 
                span #{ rsvps_count[userDataIndex] }

        
          
